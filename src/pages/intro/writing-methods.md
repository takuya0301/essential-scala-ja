## メソッドの書き方

前節では、メソッドの文法について見てきました。本書の主な目的のひとつは、文法を超えて、Scala プログラムを構築するための体系的な方法を提供することです。本節はそのような問題を扱う最初の節です。本節では、体系的にメソッドを構築する方法を見ていきます。Scala の経験を積んでいくうちに、この方法のいくつかの段階を省略することができますが、本書の中ではこの方法に従うことを**強く**推奨します。

アドバイスを具体的にするために、前節の演習を例として使用していきましょう。

**`calc` と呼ばれるオブジェクトを定義します。それは、`square` という `Double` を引数として受け取る、あなたが予想するとおり入力を2乗 (square) するメソッドを伴います。そして、計算の一部として `square` メソッドの呼び出しを含む `cube` と呼ばれる、入力を3乗 (cube) するメソッドを追加してください。**

### 入力と出力を特定する

最初の段階は、入力となる引数がもしあれば、その型とメソッドの結果型を特定することです。

多くの場合、演習では型を教えてくれるので、説明文からそのまま読み取ることができます。上の例で、入力型は `Double` になっています。結果型もまた `Double` になることが推論できます。

### テストケースを準備する

型だけでは物語のすべてを語れません。`Double` から `Double` への関数はたくさんありますが、2乗を実行しているものは少数です。そのため、メソッドの期待される振る舞いを例証するいくつかのテストケースを準備しましょう。

外部依存を避けたいので、本書ではテストライブラリを使用しないことにします。Scala が提供する `assert` 関数を使用することで手軽なテストライブラリを実装できます。`square` の例については、下記のようなテストケースが考えられます。

```scala
assert(square(2.0) == 4.0)
assert(square(3.0) == 9.0)
assert(square(-2.0) == 4.0)
```

### 宣言を書く

型とテストケースが準備できたので、メソッド宣言を書くことができます。その本体はまだ書けないので、その場所に Scala の便利な機能である `???` を使用しておきます。

```tut:book:silent
def square(in: Double): Double =
  ???
```

この段階は、前の段階で収集した情報から機械的に与えられるべきです。

### コードを実行する

コードを実行し、それがコンパイルされていること（つまり、タイプミスをしていないこと）と、また、テストが失敗すること（つまり、何らかのテストが実行されていること）を確認してください。なお、メソッド宣言の後にテストを配置する必要があるかもしれません。

### 本体を書く

メソッドの本体を書く準備が整いました。本書を通じて、いくつかのテクニックを修得していきます。現時点では、2つのテクニックを見ていきましょう。

#### 結果型を考える

最初のテクニックは、結果型を見ることです。この場合は `Double` です。どうやって `Double` の値を生成するのでしょうか？リテラルを書くこともできますが、この場合は明らかに正しくありません。`Double` を生成する他の方法は、何らかのオブジェクトのメソッドを呼び出すことで、それは次のテクニックがもたらします。

#### 入力型を考える

次のテクニックは、メソッドの入力引数の型を見ることです。この場合は `Double` です。`Double` を生成する必要があることは確立していますが、入力から `Double` を生成するためにはどのようなメソッドを呼び出せばいいのでしょうか？そのようなメソッドはたくさんありますが、ここで呼び出すべき正しいメソッドとして `*` を選択するためにはドメイン知識を活用しなければなりません。

完全なメソッドは下記のように書くことができます。

```tut:book:silent
def square(in: Double): Double =
  in * in
```

### コードを再実行する

最後に、コードを再実行して、テストがすべて通過することを確認します。

これはとても単純な例でしたが、今のプロセスを実践することで、今後遭遇するであろうより複雑な例にうまく対応できるようになります。

<div class="callout callout-info">
#### メソッドを書く方法 {-}

体系的にメソッドを書くための6段階の方法があります。

1. メソッドの入力型と出力型を特定する。
2. 入力例を与えられたメソッドの期待される出力について、いくつかのテストケースを書く。これらのケースを書き出すために `assert` 関数を使用することができる。
3. 下記のようにメソッドの本体に `???` を使用してメソッドの宣言を書く。

```scala
def name(parameter: type, ...): resultType =
 ???
```
4. コードを実行し、テストケースが実際に失敗することを確認する。
5. メソッドの本体を書く。現在のところ、ここで2つのテクニックを適用することができる。
   - 結果型とそのインスタンスをどのように生成できるかを考える
   - 入力型とそれを結果型に変化させるために呼び出せるメソッドを考える
6. コードを再実行し、テストケースが通過することを確認する。
</div>
